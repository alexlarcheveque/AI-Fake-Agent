# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

RealNurture is a real estate messaging system that uses AI to simulate conversations with potential real estate clients. The project is structured as a monorepo with separate frontend and backend components.

## Key Directories

- **Backend**:

  - Used for the core app on /frontend/app

- **Frontend**:
  - /frontend/app: Used for the core app (https://app.realnuture.ai)
  - /frontned/landing: Used for the static landing page that serves the core app

### Key Technologies

- **Backend**:

  - Node.js with Express
  - TypeScript
  - OpenAI API for AI responses
  - Twilio for SMS messaging
  - Supabase for database
  - Cron jobs for scheduled tasks (sending crafted first time messages and subsequent follow ups)

- **Frontend**:
  - React
  - Vite for building
  - TailwindCSS for styling
  - React Router for navigation
  - Testing with Jest and React Testing Library

## Command Reference

### Development Commands

```bash
# Start the backend server in development mode
cd backend && npm run dev

# Start the frontend app in development mode
cd frontend/app && npm run dev

# Start the landing page in development mode
cd frontend/landing && npm run dev
```

### Building

```bash
# Build entire project (landing page and app)
npm run build

# Build only landing page
npm run build:landing

# Build only app
npm run build:app
```

### Testing

```bash
# Run all tests
cd frontend/app && npm test

# Run backend tests
cd frontend/app && npm run test:backend

# Run frontend tests
cd frontend/app && npm run test:frontend

# Run tests in watch mode
cd frontend/app && npm run test:watch

# Run tests with coverage
cd frontend/app && npm run test:coverage
```

### Database Management

```bash
# Update TypeScript types from Supabase
cd backend && npm run update-types
```

## Architecture Overview

### Backend Structure

The backend follows a typical Express.js MVC architecture:

- **Controllers**: Handle HTTP requests and responses
- **Routes**: Define API endpoints and map them to controllers
- **Services**: Contain business logic
- **Models**: Define database schemas
- **Middleware**: Handle authentication and other cross-cutting concerns

Key backend services:

- `messageService.ts`: Handles message processing logic
- `openaiService.ts`: Integrates with OpenAI for AI responses
- `twilioService.ts`: Manages SMS communication via Twilio
- `cronService.ts`: Manages scheduled tasks to automate follow ups
- `messagingOrchestrator.ts`: Coordinates the messaging workflow

### Frontend Structure

The frontend is a React application built with Vite:

- **Components**: UI components organized by feature
- **API**: Client-side API integration with the backend
- **Contexts**: React contexts for state management
- **Hooks**: Custom hooks for reusable logic

## Autogenerated scheduled follow ups and responses

The core purpose of the app is to automatically respond for real estate agent clients. We utilize OpenAI's API to generate our messages, and we rely on Twilio to send each messages via SMS.

1. We rely on CRON schedules to check for any overdue messages - checks for "scheduled_at" property after now() along with "scheduled" delivery status for overdue messages. We also will change "sener" to "agent", which denotes it's coming from the real estate agent
2. We will run it through the OpenAI API to autogenerate the message - will PATCH "text" field on relevant message
3. Then will send it via Twilio API

## Receiving messsages

We receive our messages through Twilio's callback system.

1. We have an exposed endpoint, /api/status-callback, where Twilio can send a webhook for any new incoming message
2. We store it in our Messages DB Table, with the "sender" as "lead" and other relevant properties

## Appointment Creation Feature

The application will detect if the user wants to schedule an appointment with the real estate agent.

1. AI responses check for:
   ```
   NEW APPOINTMENT SET:
   ```
2. The system parses this data directly from AI responses

### Property Search Feature

The application has a specialized property search feature that uses a structured format for AI-assisted property searches. When implementing or modifying this feature:

1. AI responses about property searches must include structured data in a specific format:
   ```
   NEW SEARCH CRITERIA:
   ```
2. Property search criteria are cumulative - include only fields that are changing
3. The system parses this structured data directly from AI responses

## Development Guidelines

- Use TypeScript for all new code
- Follow the existing pattern of controllers, services, and routes for backend features
- Use React functional components and hooks for frontend features
- Make sure to test AI message interactions with the property search functionality
- Keep the OpenAI prompts in `services/prompts/` updated when changing AI-related functionality
